## 3.Software

> 軟體層，本專案分為以下子架構，並皆以獨立容器運行。

以下簡稱四種模式 Maping Mode (MM), Fetching Mode (FM), Serving Mode (SM), Pouring Mode (PM)。

---

### A. Coordinator 協調器

> 主要估能整合多個節點資訊，並發送目標航點給導航。
> 同時為各節點排程。


* **節點排程**：依據不同模式，調用不同節點及參數。

* **最優取球策略**：（僅 FM）由 EdgeNN 資料計算桌球密度、位置、速度等參數，決定最快取球策略。

* **最優探索路徑**：（僅 MM）由 EdgeNN 資料及探索演算法，生成快速探索全地圖的方式。

* **航點發送**：（MM、FM）經計算後，發送目標航點給導航節點。
  

※ 註：MM、FM 由 coordinator 決定航點；SM, PM 則由使用者透過 UI 決定航點。

---

### B. Navigation 導航

> 自動化的核心，盡可能最快且安全地到達指定點。

* **路徑規劃**：接收外部給予之任務目標點（FM, SM, PM），規劃出最佳路徑。

* **避障**：不同模式的避障邏輯不同。
  * MM：接近任何障礙（理應為靜態），立即停止並轉向新目標點。
  * FM：動態避障，彈性度高且等待時間低，超時將規劃新路徑。
  * SM, PM：靜態避障，將等待障礙離去才會繼續前行。
 
---

### C. EdgeNN

> 處理 Luxonis OAK-D 相機之嵌入式 AI 模型，及 ROS2 接口。

* 自定義訓練集：對人、桌球、桌球桌、球籃做物件偵測。

* ROS2 接口：將物件資訊推送至 ROS2 Topic 之上。


---

### D. RTABMAP

> 處理 RGBD 相機的點雲資訊，用以同時建圖與定位。

* 建圖：（MM）。

* 定位：（FM, SM, PM）。

---

### E. Integration

> 溝通與整合節點，具體來說為以下兩者。

* STM32 與 ROS 1 溝通：透過 rosserial 包搭建韌體端與軟體端之通訊橋梁。

* ROS1 與 ROS2 溝通：透過官方 ROS1 Bridge 包搭建 ROS1 與 ROS2 的通訊。
